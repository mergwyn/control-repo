---

classes:
  - role::lxd_server
  - role::backup_server
  - role::file_server

#- profile::domain_sso
#- nginx
#- network
#- profile::lxd_host

#unattended_upgrades:
#  stable:
#      origin:                   'Jamie Cameron'

network::interfaces_hash:
  enp3s0:
    method:                     manual
    pre_up:
      - /sbin/ifconfig enp3s0 mtu 9004
  enp4s0:
    method:                     manual
    pre_up:
      - /sbin/ifconfig enp4s0 mtu 9004
  br0:
    ipaddress:                  "192.168.11.12"
    netmask:                    "%{hiera('defaults::netmask')}"
    gateway:                    "%{hiera('defaults::gateway')}"
    network:                    "%{hiera('defaults::network')}"
    dns_nameservers:            "%{hiera('defaults::dns_nameservers')}"
    dns_search:                 "%{hiera('defaults::dns_search')}"
    bridge_ports:
      - enp3s0
      - enp4s0
    bridge_maxwait:             "0"
    bridge_fd:                  "0"
    bridge_stp:                 "off"

nginx::nginx_servers:
  'backuppc':
    server_name:                [ "%{::fqdn}" ]
    listen_port:                80
    www_root:                   '/usr/share/nginx/html'
    use_default_location:       false
nginx::nginx_locations:
  '/backuppc':
    server:                     'backuppc'
    index_files:                [ "/index.cgi" ]
    location_cfg_append:
      auth_pam:                 '"BackupPC admin"'
      auth_pam_service_name:    '"nginx"'
    location_alias:             '/usr/share/backuppc/cgi-bin/'
  'cgi':
    server:                     'backuppc'
    location:                   '~\.cgi$'
    fastcgi:                    'unix:/var/run/fcgiwrap.socket'
    fastcgi_script:             '/usr/share/backuppc/cgi-bin$fastcgi_script_name'
    fastcgi_params:             '/etc/nginx/fastcgi_params'
    fastcgi_index:              'BackupPC_Admin'
    location_cfg_append:
      gzip:                     'off'

---
# vim: sw=2:ai:nu expandtab
