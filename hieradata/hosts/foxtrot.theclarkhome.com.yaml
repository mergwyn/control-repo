---

classes:
  - role::lxd_server
  - role::backup_server
  - role::file_server

#- profile::domain_sso
#- nginx
#- network
#- profile::lxd_host

#unattended_upgrades:
#  stable:
#      origin:                   'Jamie Cameron'

network::interfaces_hash:
  enp3s0:
    method:                     manual
    pre_up:
      - /sbin/ifconfig enp3s0 mtu 9004
  enp4s0:
    method:                     manual
    pre_up:
      - /sbin/ifconfig enp4s0 mtu 9004
  br0:
    ipaddress:                  "192.168.11.12"
    netmask:                    "%{hiera('defaults::netmask')}"
    gateway:                    "%{hiera('defaults::gateway')}"
    network:                    "%{hiera('defaults::network')}"
    dns_nameservers:            "%{hiera('defaults::dns_nameservers')}"
    dns_search:                 "%{hiera('defaults::dns_search')}"
    bridge_ports:
      - enp3s0
      - enp4s0
    bridge_maxwait:             "0"
    bridge_fd:                  "0"
    bridge_stp:                 "off"

nginx::nginx_servers:
  'webdav':
    server_name:                [ "%{::fqdn}" ]
    listen_port:                80
    use_default_location:       false
  'munki_repo':
    server_name:                [ "%{::fqdn}" ]
    listen_port:                80
    use_default_location:       false
nginx::nginx_locations:
  '/webdav':
    server:                     'webdav'
    autoindex:                  'on'
    index_files:                [ "/index.cgi" ]
    location_alias:             '/srv/webdav'
    location_cfg_append:
      auth_pam:                 '"Restricted area"'
      auth_pam_service_name:    '"nginx"'
      dav_methods:              'PUT DELETE MKCOL COPY MOVE'
      dav_ext_methods:          'PROPFIND OPTIONS'
      dav_access:               'group:rw all:r'
      create_full_put_path:     'on'
  '/munki_repo/':
    server:                     'munki_repo'
    location_alias:             '/usr/share/nginx/html/munki-repo/'
    autoindex:                  'off'
    location_cfg_append:
      auth_pam:                 '"Restricted area"'
      auth_pam_service_name:    '"nginx"'


---
# vim: sw=2:ai:nu expandtab
