---

classes:
  - timezone
  - profile::puppet::agent
  - profile::base::avahi
  - profile::base::ssh_server
  - profile::base::mail_client
  - profile::base::unattended_upgrades
  - profile::base::webmin_generic
  - profile::zabbix::agent
  - profile::backuppc::client

profile::base::users::defaults:
  ensure: present
profile::base::users::objects:
  root:
    password: "%{lookup('defaults::sharedpassword')}"
  ubuntu:
    ensure: absent
  sadmin:
    password: "%{lookup('defaults::sharedpassword')}"
    groups: 'sudo'
    uid: '1000'
    managehome: true

profile::base::files::defaults:
  ensure: present
profile::base::files::objects:
  # relateded to users
  /root/.profile:
    source: 'file:///etc/skel/.profile'
  /root/.bashrc:
    source: 'puppet:///modules/profile/bashrc'
  /root/.bash_aliases:
    source: 'puppet:///modules/profile/bash_aliases'
  /etc/skel/.bashrc:
    source: 'puppet:///modules/profile/bashrc'
  /etc/skel/.bash_aliases:
    source: 'puppet:///modules/profile/bash_aliases'
  /etc/vim/vimrc.local:
    source: 'puppet:///modules/profile/vimrc.local'
  # General
  /etc/landscape/client.conf:
    content: "[sysinfo]\nexclude_sysinfo_plugins = LandscapeLink\n"
  /etc/update-motd.d/10-help-text:
    ensure: absent
  /etc/legal:
    ensure: absent

profile::base::packages::defaults:
  ensure: present
profile::base::packages::objects:
  ubuntu-standard: {}
  update-notifier-common: {}
  landscape-common: {}
  vim: {}
  anacron: {}
  gpg: {}
  vim-tiny:
    ensure: absent
  mlocate:
    ensure: absent

profile::base::hosts:
  "%{facts.networking.hostname}":
    ensure: absent
    ip:     '127.0.1.1'
  "%{trusted.certname}":
    ensure: absent
    ip:     '127.0.1.1'
    host_aliases: "%{trusted.hostname}"

# puppet agent
puppet::puppet_server:                  "echo.%{domain}"
puppet::manage_repos:                   false
puppet::structured_facts:               true

profile::base::mail_client::myorigin:         "%{domain}"
profile::base::mail_client::password_credentials: "mergwyn@virginmedia.com:%{hiera('secrets::virgin')}"
profile::base::mail_client::password_hash:    '/etc/postfix/sasl-passwords'
profile::base::mail_client::relayhost:        '[smtp.virginmedia.com]:465'
profile::base::mail_client::root_mail_recipient: "%{hiera('defaults::adminemail')}"

# store ssh keys
ssh::storeconfigs_enabled:              true

# time related
timezone::timezone:                     'Europe/London'

ntp::driftfile:                         '/var/lib/ntp/ntp.drift'
ntp::logfile:                           '/var/log/ntp'
ntp::ntpsigndsocket:                    '/var/lib/samba/ntp_signd/'
ntp::servers:
  - 127.127.1.0
  - foxtrot.%{domain}  iburst prefer
  - golf.%{domain}  iburst prefer
ntp::fudge: 
  - 127.127.1.0 stratum 10
ntp::restrict:
  - default kod nomodify notrap nopeer mssntp
  - 127.0.0.1
  - foxtrot.%{domain} mask 255.255.255.255 nomodify notrap nopeer noquery
  - golf.%{domain} mask 255.255.255.255 nomodify notrap nopeer noquery

unattended_upgrades::period:            '1'
unattended_upgrades::autoremove:        true
unattended_upgrades::email:             "%{hiera('defaults::adminemail')}"
unattended_upgrades:
  repos:
    "%{lsbdistcodename}-security":
      origin:                           'Ubuntu'
    'Zabbix':
      origin:                           'Zabbix'
  stable:
      origin:                           'Jamie Cameron'


# set nginx package
nginx::package_name:                    'nginx-extras'

samba::params::sernetpkgs:              false
samba::classic::domain:                 "%{hiera('defaults::workgroup')}"
samba::classic::realm:                  "%{hiera('defaults::realm')}"

mysql::server::manage_config_file:      false

zabbix::agent::zabbix_version:          '3.4'
zabbix::server::zabbix_version:         '3.4'
zabbix::zabbix_url:                     "%{fqdn}"
zabbix::zabbix_server:                  "%{hostname}"
zabbix::database_type:                  'mysql'
zabbix::database_name:                  'zabbix'
zabbix::database_user:                  'zabbix'
zabbix::database_password:              'ls278sq'

zabbix::agent::listenip:                "%{facts.networking.ip}"
zabbix::agent::hostname:                "%{fqdn}"
zabbix::agent::server:                  "zulu,zulu.%{domain}"
zabbix::agent::serveractive:            "zulu,zulu.%{domain}"
zabbix::agent::enableremotecommands:    '1'

profile::backuppc::scripts:             '/etc/backuppc/scripts'
profile::backuppc::preuser:             "%{hiera('profile::backuppc::scripts')}/DumpPreUser"
profile::backuppc::postuser:            "%{hiera('profile::backuppc::scripts')}/DumpPostUser"

# vim: sw=2:ai:nu expandtab
#
