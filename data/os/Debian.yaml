
classes:
  - timezone

profile::base::packages::defaults:
  ensure:                                         present
profile::base::packages::objects:
  vim:                                            {}
  anacron:                                        {}
  gpg:                                            {}
  vim-tiny:
    ensure:                                       absent
  mlocate:
    ensure:                                       absent

profile::base::hosts::defaults:
  ensure:                                         present
profile::base::hosts::objects:
  "%{trusted.hostname}":
    ensure:                                       absent
    ip:                                           '127.0.1.1'
  "%{trusted.certname}":
    ensure:                                       present
    ip:                                           '127.0.1.1'
    host_aliases:                                 "%{trusted.hostname}"
  localhost:
    ensure:                                       absent
    ip:                                           '127.0.0.1'
  localhost:
    ip:                                           '127.0.0.1'
    host_aliases:                                 "localhost.%{trusted.domain}"
  ip6-localhost:
    ip:                                           '::1'
    host_aliases:                                 'ip6-loopback'
  ip6-localnet:
    ip:                                           'fe00::0'
  ip6-mcastprefix:
    ip:                                           'ff00::0'
  ip6-allnodes:
    ip:                                           'ff02::1'
  ip6-allrouters:
    ip:                                           'ff02::2'
  ip6-allhosts:
    ip:                                           'ff02::3'


profile::base::mail_client::myorigin:             "%{trusted.domain}"
profile::base::mail_client::password_credentials: "mergwyn@virginmedia.com:%{lookup('secrets::virgin')}"
profile::base::mail_client::password_hash:        '/etc/postfix/sasl-passwords'
profile::base::mail_client::relayhost:            '[smtp.virginmedia.com]:465'
profile::base::mail_client::root_mail_recipient:  "%{lookup('defaults::adminemail')}"

profile::backuppc::client::scripts:                '/etc/backuppc-scripts'
profile::backuppc::client::preuser:                "%{lookup('profile::backuppc::client::scripts')}/DumpPreUser"
profile::backuppc::client::postuser:               "%{lookup('profile::backuppc::client::scripts')}/DumpPostUser"

# puppet agent
puppet::puppet_server:                            "echo.%{trusted.domain}"
puppet::manage_repos:                             false
puppet::structured_facts:                         true

# time related
timezone::timezone:                               'Europe/London'

ntp::driftfile:                                   '/var/lib/ntp/ntp.drift'
ntp::logfile:                                     '/var/log/ntp'
ntp::ntpsigndsocket:                              '/var/lib/samba/ntp_signd/'
ntp::servers:
  - 127.127.1.0
  - foxtrot.%{trusted.domain}  iburst prefer
  - golf.%{trusted.domain}  iburst prefer
ntp::fudge:                                       
  - 127.127.1.0 stratum 10
ntp::restrict:
  - default kod nomodify notrap nopeer mssntp
  - 127.0.0.1
  - foxtrot.%{trusted.domain} mask 255.255.255.255 nomodify notrap nopeer noquery
  - golf.%{trusted.domain} mask 255.255.255.255 nomodify notrap nopeer noquery

unattended_upgrades::period:                      '1'
unattended_upgrades::autoremove:                  true
unattended_upgrades::email:                       "%{lookup('defaults::adminemail')}"
unattended_upgrades:
  repos:
    "%{lsbdistcodename}-security":
      origin:                                     'Ubuntu'
    'Zabbix':
      origin:                                     'Zabbix'
  stable:
      origin:                                     'Jamie Cameron'


# set nginx package
nginx::package_name:                              'nginx-extras'
nginx::nginx_cfg_prepend:
  include:
    - '/etc/nginx/modules-enabled/*.conf'

samba::params::sernetpkgs:                        false
samba::classic::domain:                           "%{lookup('defaults::workgroup')}"
samba::classic::realm:                            "%{lookup('defaults::realm')}"

mysql::server::manage_config_file:                false

zabbix::agent::zabbix_version:                    '4.4'
zabbix::agent::hostname:                          "%{trusted.certname}"
zabbix::agent::server:                            "zulu,zulu.%{trusted.domain}"
zabbix::agent::serveractive:                      "zulu,zulu.%{trusted.domain}"
zabbix::agent::enableremotecommands:              '1'
zabbix::agent::zabbix_package_state:              'latest'
zabbix::agent::hostmetadata:                      ":kernel=%{facts.kernel}:virtual=%{facts.virtual}"

# backuppc client
profile::backuppc::client::backuppc_hostname:     "foxtrot.%{domain}"
profile::backuppc::client::backup_files_exclude:
  '*':
    - '.AppleDouble'
    - '.cache'
    - '*.converted'
    - '*.original'
    - 'Downloads'
    - 'exclude'
    - '.fsck'
    - 'gsyncit.log*'
    - '.journal'
    - '*.ldb'
    - 'Library/Caches'
    - 'Library*/Mail/Caches'
    - 'Library*/Mail/V3'
    - '*/lost+found*'
    - 'nobackup'
    - '.osync_workdir'
    - '*.ova'
    - '*Recycle Bin*'
    - 'srv/backup'
    - '*.tar'
    - 'tmp'
    - '.Trash'
    - '*/trashbox*'
    - '*.vdi'
    - '*.vmdk'
    - '.zfs'
    - 'Movies'
    - 'TV Shows'
    - 'media/.config/Radarr/logs*'
  '/':
    - 'opt/puppetlabs/server/data/puppetserver/reports'
    - 'var/lib/apt/lists'
    - 'var/lib/dkms/open-vm-tools'
    - 'var/lib/dkms/spl'
    - 'var/lib/dkms/zfs'
    - 'var/lib/minidlna/art_cache'
    - 'var/lib/mlocate/mlocate.db*'
    - 'var/lib/mysql/zabbix*'
    - 'var/lib/php/sessions/*'
    - 'var/tmp'
    - 'var/webmin/output'
    - 'opt/puppetlabs/puppet/cache'

